#!/bin/bash
TARGET=$1
RESULT_DIR="results/$TARGET"
LIVE_HOSTS_FILE="$RESULT_DIR/live_hosts.txt"
NUCLEI_OUTPUT_FILE="$RESULT_DIR/nuclei_raw.txt"
echo "=================================================="
echo "Starting Vulnerability Scan Module for: $TARGET"
echo "=================================================="
if [ ! -s "$LIVE_HOSTS_FILE" ]; then
    echo "[!] No live hosts found for $TARGET. Skipping vulnerability scan."
    echo "findings_detected=false" >> $GITHUB_OUTPUT
    exit 0
fi
echo "[*] Running nuclei for vulnerabilities..."
nuclei -l $LIVE_HOSTS_FILE -t "technologies,cves,vulnerabilities,misconfiguration" -o $NUCLEI_OUTPUT_FILE -silent -severity critical,high,medium
if [ -s "$NUCLEI_OUTPUT_FILE" ]; then
    echo "[+] Vulnerabilities found for $TARGET!"
    echo "findings_detected=true" >> $GITHUB_OUTPUT
else
    echo "[-] No vulnerabilities found for $TARGET."
    echo "findings_detected=false" >> $GITHUB_OUTPUT
fi
echo "[+] Vulnerability Scan Module finished for $TARGET."
